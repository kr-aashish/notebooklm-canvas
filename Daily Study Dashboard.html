<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Progress Tracker</title>
    <link rel="icon" type="image/png" href="https://us1.discourse-cdn.com/flex002/uploads/anki2/original/2X/2/24bfef76259176f6f6e369b588d07f614d6d631c.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Tailwind gray-900 */
        }
        /* --- Custom Scrollbar --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        /* --- Entry Animation --- */
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .task-item, .add-task-form-container { animation: fadeInSlideUp 0.5s ease-out forwards; }
        
        /* --- Progress Bar --- */
        .progress-bar-fill { transition: width 0.5s ease-in-out; }
        
        /* --- Number Input Customization --- */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] { -moz-appearance: textfield; }

        /* --- Beautiful Loading Spinner --- */
        .loader {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: relative;
            animation: rotate 1.2s linear infinite;
            margin: 5rem auto;
        }
        .loader::before, .loader::after {
            content: "";
            box-sizing: border-box;
            position: absolute;
            inset: 0px;
            border-radius: 50%;
            border: 5px solid #1f2937; /* gray-800 */
            animation: prixClipFix 2s linear infinite;
        }
        .loader::after {
            border-color: #38bdf8; /* sky-400 */
            animation: prixClipFix 2s linear infinite, rotate 0.5s linear infinite reverse;
            inset: 6px;
        }
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes prixClipFix {
            0%   { clip-path: polygon(50% 50%, 0 0, 0 0, 0 0, 0 0, 0 0) }
            25%  { clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 0, 100% 0, 100% 0) }
            50%  { clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 100%, 100% 100%, 100% 100%) }
            75%  { clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 100%, 0 100%, 0 100%) }
            100% { clip-path: polygon(50% 50%, 0 0, 100% 0, 100% 100%, 0 100%, 0 0) }
        }

        /* --- Typewriter Animation --- */
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #38bdf8; } /* sky-400 */
        }
        .typing-cursor {
            border-right: .1em solid #38bdf8;
            animation: blink-caret .75s step-end infinite;
            white-space: nowrap; /* Keeps cursor at the end */
        }

        /* --- Editable Content Styling --- */
        [contenteditable="true"]:hover {
            outline: 2px dashed #4b5563; /* Tailwind gray-600 */
            border-radius: 4px;
        }
        [contenteditable="true"]:focus {
            outline: 2px solid #38bdf8; /* Tailwind sky-400 */
            background-color: #1f2937; /* Tailwind gray-800 */
            border-radius: 4px;
        }
    </style>
</head>
<body class="text-gray-200 antialiased">

<div class="container mx-auto max-w-4xl p-4 sm:p-6 md:p-8">
    <header class="text-center mb-8">
        <h1 class="text-4xl sm:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-cyan-400 pb-2 min-h-[56px] sm:min-h-[72px]"></h1>
        <p class="text-gray-400 mt-2 text-lg min-h-[28px]"></p>
    </header>

    <main id="main-content" class="space-y-3">
        <!-- Loader is displayed here initially -->
        <div class="loader"></div>
        <p class="text-center text-gray-400">Loading your tracker...</p>
    </main>

    <footer class="text-center mt-12 text-gray-500 text-sm">
        <p class="min-h-[20px]"></p>
    </footer>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const DURATION_IN_DAYS = 4;
        const DEFAULT_TASKS = [];

        let tasks = [];
        let progressState = {};

        const mainContentContainer = document.getElementById('main-content');
        const titleElement = document.querySelector('header h1');
        const subtitleElement = document.querySelector('header p');
        const footerElement = document.querySelector('footer p');
        
        // --- App Initialization ---
        // Show loader for 1 second, then initialize the main application UI
        setTimeout(() => {
            initializeAppUI();
        }, 1000);

        function loadStateFromLocal() {
            const savedTasks = localStorage.getItem('studyTasks');
            const savedProgress = localStorage.getItem('studyProgressState');

            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            } else {
                tasks = DEFAULT_TASKS.map(task => ({
                    id: task.id,
                    name: task.name,
                    totalGoal: task.dailyGoal * DURATION_IN_DAYS
                }));
            }

            progressState = savedProgress ? JSON.parse(savedProgress) : {};
            syncAndValidateState();
        }

        function getSavedTexts() {
            const savedTitle = localStorage.getItem('studyTrackerTitle') || 'Study Progress Tracker';
            const savedSubtitle = localStorage.getItem('studyTrackerSubtitle') || 'Your customizable study plan and progress tracker.';
            const savedFooter = localStorage.getItem('studyTrackerFooter') || 'Happy studying!';
            return { title: savedTitle, subtitle: savedSubtitle, footer: savedFooter };
        }

        function syncAndValidateState() {
            const taskIds = tasks.map(t => t.id);
            Object.keys(progressState).forEach(id => {
                if (!taskIds.includes(id)) {
                    delete progressState[id]; // Clean up old progress data
                }
            });
            tasks.forEach(task => {
                if (progressState[task.id] === undefined) {
                    progressState[task.id] = 0;
                }
            });
        }

        function saveState() {
            // Save task data to local cache immediately
            localStorage.setItem('studyTasks', JSON.stringify(tasks));
            localStorage.setItem('studyProgressState', JSON.stringify(progressState));
        }

        function saveTextState() {
            // Save editable text to local cache
            localStorage.setItem('studyTrackerTitle', titleElement.innerHTML);
            localStorage.setItem('studyTrackerSubtitle', subtitleElement.innerHTML);
            localStorage.setItem('studyTrackerFooter', footerElement.innerHTML);
        }

        function render() {
            mainContentContainer.innerHTML = ''; // Clear previous content (including loader)

            const tasksContainer = document.createElement('div');
            tasksContainer.id = 'tasks-container';
            tasksContainer.className = 'space-y-3';
            
            if (tasks.length === 0) {
                 tasksContainer.innerHTML = `<div class="text-center text-gray-500 py-10">No tasks yet. Add one below to get started!</div>`;
            } else {
                tasks.forEach((task, taskIndex) => {
                    const taskTotalGoal = task.totalGoal;
                    const taskItem = document.createElement('div');
                    taskItem.className = 'task-item bg-gray-800 rounded-lg shadow-md p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4';
                    taskItem.style.animationDelay = `${taskIndex * 50}ms`;
                    taskItem.innerHTML = `
                        <div class="w-full sm:w-auto flex-grow sm:pr-4">
                            <div class="flex justify-between items-baseline mb-1">
                                <span class="font-semibold text-gray-300">${task.name}</span>
                                <span id="task-progress-text-${task.id}" class="text-xs font-medium text-gray-400">0 / ${taskTotalGoal}</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2">
                                <div id="task-progress-bar-${task.id}" class="progress-bar-fill bg-sky-500 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 sm:space-x-3 flex-shrink-0 self-end sm:self-center">
                             <button class="control-btn remove-btn w-8 h-8 rounded-full bg-gray-700 hover:bg-rose-600 transition-colors flex items-center justify-center" data-task="${task.id}" title="Remove Task">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                            <button class="control-btn minus-btn w-8 h-8 rounded-full bg-gray-700 hover:bg-red-500 transition-colors flex items-center justify-center font-bold text-xl" data-task="${task.id}" data-change="-1" title="Decrement items done">-</button>
                            <div class="flex items-center space-x-1">
                                 <span class="text-gray-400 text-sm whitespace-nowrap">Done:</span>
                                 <input type="number" class="task-input-done w-14 text-center bg-gray-900 border border-gray-600 rounded-md h-8 focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="0" min="0" data-task="${task.id}">
                                 <span class="text-gray-400">/</span>
                                 <input type="number" class="task-input-total w-14 text-center bg-gray-900 border border-gray-600 rounded-md h-8 focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="${taskTotalGoal}" min="0" data-task="${task.id}">
                            </div>
                            <button class="control-btn plus-btn w-8 h-8 rounded-full bg-gray-700 hover:bg-green-500 transition-colors flex items-center justify-center font-bold text-xl" data-task="${task.id}" data-change="1" title="Increment items done">+</button>
                        </div>
                    `;
                    tasksContainer.appendChild(taskItem);
                });
            }
            mainContentContainer.appendChild(tasksContainer);

            // Render the "Add Task" form
            const addTaskFormHTML = `
                <div class="add-task-form-container bg-gray-800/50 rounded-lg p-4 mt-6">
                    <h3 class="text-lg font-semibold text-gray-300 mb-3">Add New Task</h3>
                    <form id="add-task-form" class="flex flex-col sm:flex-row gap-3">
                        <input type="text" id="new-task-name" placeholder="Task Name" class="flex-grow bg-gray-900 border border-gray-600 rounded-md h-10 px-3 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" required>
                        <input type="number" id="new-task-goal" placeholder="Total Goal" class="w-full sm:w-32 bg-gray-900 border border-gray-600 rounded-md h-10 px-3 text-center focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" min="1" required>
                        <button type="submit" class="bg-emerald-600 hover:bg-emerald-700 rounded-md h-10 px-5 font-semibold transition-colors flex items-center justify-center">Add Task</button>
                    </form>
                </div>
            `;
            mainContentContainer.insertAdjacentHTML('beforeend', addTaskFormHTML);
            updateUI();
        }

        function updateUI() {
            tasks.forEach(task => {
                const taskTotalGoal = Number(task.totalGoal);
                const taskCompleted = Number(progressState[task.id] || 0);
                const taskPercent = taskTotalGoal > 0 ? (taskCompleted / taskTotalGoal) * 100 : 0;
                
                const doneInput = document.querySelector(`.task-input-done[data-task="${task.id}"]`);
                const totalInput = document.querySelector(`.task-input-total[data-task="${task.id}"]`);
                const progressBar = document.getElementById(`task-progress-bar-${task.id}`);
                const progressText = document.getElementById(`task-progress-text-${task.id}`);

                if(doneInput) {
                    doneInput.value = taskCompleted;
                    doneInput.max = taskTotalGoal;
                }
                if(totalInput) totalInput.value = taskTotalGoal;
                if(progressBar) progressBar.style.width = `${taskPercent}%`;
                if(progressText) progressText.textContent = `${taskCompleted} / ${taskTotalGoal}`;
            });
        }
        
        function attachEventListeners() {
            // Event listeners for task interactions
            mainContentContainer.addEventListener('input', (e) => {
                const taskId = e.target.dataset.task;
                const task = tasks.find(t => t.id === taskId);
                if (!task) return;

                if (e.target.classList.contains('task-input-done')) {
                    const doneValue = parseInt(e.target.value, 10);
                    if (!isNaN(doneValue)) {
                        const taskTotalGoal = Number(task.totalGoal);
                        progressState[taskId] = Math.max(0, Math.min(doneValue, taskTotalGoal));
                        saveState();
                        updateUI();
                    }
                }

                if (e.target.classList.contains('task-input-total')) {
                    const newTotalGoal = parseInt(e.target.value, 10);
                    if (!isNaN(newTotalGoal) && newTotalGoal >= 0) {
                        task.totalGoal = newTotalGoal;
                        if(newTotalGoal < progressState[taskId]) {
                            progressState[taskId] = newTotalGoal;
                        }
                        saveState();
                        updateUI();
                    }
                }
            });

            mainContentContainer.addEventListener('click', (e) => {
                const controlBtn = e.target.closest('.control-btn');
                if(!controlBtn) return;

                const { task: taskId } = controlBtn.dataset;
                const task = tasks.find(t => t.id === taskId);
                if (!task) return;

                if (controlBtn.classList.contains('plus-btn') || controlBtn.classList.contains('minus-btn')) {
                    const change = parseInt(controlBtn.dataset.change, 10);
                    const taskTotalGoal = Number(task.totalGoal);
                    let currentDone = progressState[taskId] || 0;
                    let newTotalDone = currentDone + change;
                    progressState[taskId] = Math.max(0, Math.min(newTotalDone, taskTotalGoal));
                    saveState();
                    updateUI();
                } else if (controlBtn.classList.contains('remove-btn')) {
                    tasks = tasks.filter(t => t.id !== taskId);
                    delete progressState[taskId];
                    saveState();
                    render(); // Re-render to remove the element
                }
            });

            mainContentContainer.addEventListener('submit', (e) => {
                if (e.target.id === 'add-task-form') {
                    e.preventDefault();
                    const nameInput = document.getElementById('new-task-name');
                    const goalInput = document.getElementById('new-task-goal');
                    const name = nameInput.value.trim();
                    const goal = parseInt(goalInput.value, 10);

                    if (name && !isNaN(goal) && goal > 0) {
                        const newTask = {
                            id: `task-${Date.now()}`,
                            name: name,
                            totalGoal: goal
                        };
                        tasks.push(newTask);
                        progressState[newTask.id] = 0;
                        saveState();
                        render();
                        nameInput.value = '';
                        goalInput.value = '';
                        nameInput.focus();
                    }
                }
            });
        }
        
        function typeWriter(element, text, callback) {
            let i = 0;
            const speed = 50; // Typing speed in ms
            element.classList.add('typing-cursor');

            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                } else {
                    element.classList.remove('typing-cursor');
                    element.setAttribute('contenteditable', 'true');
                    if (callback) callback();
                }
            }
            type();
        }

        function initializeAppUI() {
            // Load task data
            loadStateFromLocal();
            // Render the main task area
            render();
            attachEventListeners();
            
            // Load text data and start animations
            const { title, subtitle, footer } = getSavedTexts();

            typeWriter(titleElement, title, () => {
                typeWriter(subtitleElement, subtitle, () => {
                    typeWriter(footerElement, footer, null);
                });
            });
        }

        // Event listeners for saving editable text
        titleElement.addEventListener('blur', saveTextState);
        subtitleElement.addEventListener('blur', saveTextState);
        footerElement.addEventListener('blur', saveTextState);
    });
</script>
</body>
</html>

