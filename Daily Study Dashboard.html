<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Progress Tracker</title>
    <link rel="icon" type="image/png" href="https://us1.discourse-cdn.com/flex002/uploads/anki2/original/2X/2/24bfef76259176f6f6e369b588d07f614d6d631c.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Tailwind gray-900 */
        }

        /* --- Custom Scrollbar --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }

        /* --- Entry Animation --- */
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .task-item { animation: fadeInSlideUp 0.5s ease-out forwards; opacity: 0; }

        /* --- Progress Bar --- */
        .progress-bar-fill { transition: width 0.5s ease-in-out; }

        /* --- Number Input Customization --- */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="text-gray-200 antialiased">

<div class="container mx-auto max-w-4xl p-4 sm:p-6 md:p-8">
    <header class="text-center mb-8">
        <h1 class="text-4xl sm:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-cyan-400 pb-2">
            Study Progress Tracker
        </h1>
        <p class="text-gray-400 mt-2 text-lg">Your 4-day study plan and progress tracker.</p>
    </header>

    <main id="main-content" class="space-y-3">
        <!-- Content is generated by JavaScript -->
    </main>

    <footer class="text-center mt-12 text-gray-500 text-sm">
        <p>Happy studying!</p>
    </footer>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const DURATION_IN_DAYS = 4;
        const TASKS = [
            { id: 'dp-flashcards', name: 'dp', dailyGoal: 6 },
            { id: 'graph', name: 'graph', dailyGoal: 35 },
            { id: 'jb', name: 'iB', dailyGoal: 25 },
            { id: 'faqs', name: 'FAQs', dailyGoal: 6 },
            { id: 'misc', name: 'Misc Cards', dailyGoal: 108 },
            { id: 'anki-misc', name: 'AD + FAQs + Misc: With Anki', dailyGoal: 4 },
            { id: 'lc-discuss', name: 'LC Discuss', dailyGoal: 10 },
            { id: 'lc', name: 'LC Set', dailyGoal: 14 },
        ];

        const OVERALL_TOTAL_GOAL = TASKS.reduce((sum, task) => sum + (task.dailyGoal * DURATION_IN_DAYS), 0);

        // The state stores the total number of items DONE for each task.
        // e.g., { 'dp-flashcards': 10, 'graph': 25 }
        let progressState = {};

        const mainContentContainer = document.getElementById('main-content');

        function loadState() {
            const savedState = localStorage.getItem('studyProgressState');
            if (savedState) {
                progressState = JSON.parse(savedState);
                // Ensure all tasks are in the state object, even if new ones are added
                TASKS.forEach(task => {
                    if (progressState[task.id] === undefined) {
                        progressState[task.id] = 0;
                    }
                });
            } else {
                // Initialize state if nothing is saved
                TASKS.forEach(task => {
                    progressState[task.id] = 0;
                });
            }
        }

        function saveState() {
            localStorage.setItem('studyProgressState', JSON.stringify(progressState));
        }

        function render() {
            mainContentContainer.innerHTML = ''; // Clear previous content

            // 1. Render Overall Progress Bar
            const overallProgressHTML = `
                <div class="space-y-4 mb-6 bg-gray-800/50 p-4 rounded-lg">
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="text-base font-medium text-emerald-400">Overall Progress</span>
                            <span id="overall-progress-text" class="text-sm font-medium text-emerald-400">0 / ${OVERALL_TOTAL_GOAL}</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2.5">
                            <div id="overall-progress-bar" class="progress-bar-fill bg-emerald-500 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            `;
            mainContentContainer.innerHTML = overallProgressHTML;

            // 2. Render all tasks
            const tasksContainer = document.createElement('div');
            tasksContainer.className = 'space-y-3';
            TASKS.forEach((task, taskIndex) => {
                const taskTotalGoal = task.dailyGoal * DURATION_IN_DAYS;
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item bg-gray-800 rounded-lg shadow-md p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4';
                taskItem.style.animationDelay = `${taskIndex * 50}ms`;
                taskItem.innerHTML = `
                    <div class="w-full sm:w-auto flex-grow sm:pr-4">
                        <div class="flex justify-between items-baseline mb-1">
                            <span class="font-semibold text-gray-300">${task.name}</span>
                            <span id="task-progress-text-${task.id}" class="text-xs font-medium text-gray-400">0 / ${taskTotalGoal}</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div id="task-progress-bar-${task.id}" class="progress-bar-fill bg-sky-500 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 sm:space-x-3 flex-shrink-0 self-end sm:self-center">
                        <button class="control-btn minus-btn w-8 h-8 rounded-full bg-gray-700 hover:bg-red-500 transition-colors flex items-center justify-center font-bold text-xl" data-task="${task.id}" data-change="-1" title="Decrement items done">-</button>
                        <div class="flex items-center space-x-2">
                             <span class="text-gray-400 text-sm whitespace-nowrap">Left:</span>
                             <input type="number" class="task-input w-14 text-center bg-gray-900 border border-gray-600 rounded-md h-8 focus:ring-2 focus:ring-sky-500 focus:border-sky-500" value="${taskTotalGoal}" min="0" max="${taskTotalGoal}" data-task="${task.id}">
                             <span class="text-gray-400 text-sm">/ ${taskTotalGoal}</span>
                        </div>
                        <button class="control-btn plus-btn w-8 h-8 rounded-full bg-gray-700 hover:bg-green-500 transition-colors flex items-center justify-center font-bold text-xl" data-task="${task.id}" data-change="1" title="Increment items done">+</button>
                    </div>
                `;
                tasksContainer.appendChild(taskItem);
            });

            mainContentContainer.appendChild(tasksContainer);
        }

        function updateUI() {
            const totalCompleted = Object.values(progressState).reduce((sum, current) => sum + current, 0);

            // Update overall progress bar
            const overallPercent = OVERALL_TOTAL_GOAL > 0 ? (totalCompleted / OVERALL_TOTAL_GOAL) * 100 : 0;
            const overallProgressBar = document.getElementById('overall-progress-bar');
            const overallProgressText = document.getElementById('overall-progress-text');
            if(overallProgressBar) overallProgressBar.style.width = `${overallPercent}%`;
            if(overallProgressText) overallProgressText.textContent = `${totalCompleted} / ${OVERALL_TOTAL_GOAL}`;

            // Update each task's UI
            TASKS.forEach(task => {
                const taskTotalGoal = task.dailyGoal * DURATION_IN_DAYS;
                const taskCompleted = progressState[task.id] || 0;
                const taskRemaining = taskTotalGoal - taskCompleted;
                const taskPercent = taskTotalGoal > 0 ? (taskCompleted / taskTotalGoal) * 100 : 0;
                
                const input = document.querySelector(`.task-input[data-task="${task.id}"]`);
                const progressBar = document.getElementById(`task-progress-bar-${task.id}`);
                const progressText = document.getElementById(`task-progress-text-${task.id}`);

                if(input) input.value = taskRemaining;
                if(progressBar) progressBar.style.width = `${taskPercent}%`;
                if(progressText) progressText.textContent = `${taskCompleted} / ${taskTotalGoal}`;
            });
        }
        
        function attachEventListeners() {
            mainContentContainer.addEventListener('input', (e) => {
                if (e.target.classList.contains('task-input')) {
                    const taskId = e.target.dataset.task;
                    const task = TASKS.find(t => t.id === taskId);
                    if (!task) return;
                    
                    const remainingValue = parseInt(e.target.value, 10);
                    if (!isNaN(remainingValue)) {
                        const taskTotalGoal = task.dailyGoal * DURATION_IN_DAYS;
                        let doneValue = taskTotalGoal - remainingValue;
                        // Clamp the value between 0 and the total goal
                        doneValue = Math.max(0, Math.min(doneValue, taskTotalGoal));
                        
                        progressState[taskId] = doneValue;
                        saveState();
                        updateUI();
                    }
                }
            });

            mainContentContainer.addEventListener('click', (e) => {
                const controlBtn = e.target.closest('.control-btn');
                if(controlBtn) {
                    const { task: taskId, change } = controlBtn.dataset;
                    const task = TASKS.find(t => t.id === taskId);
                    if (!task) return;

                    const taskTotalGoal = task.dailyGoal * DURATION_IN_DAYS;
                    let currentDone = progressState[taskId] || 0;
                    let newTotalDone = currentDone + parseInt(change, 10);
                    // Clamp the value between 0 and the total goal
                    newTotalDone = Math.max(0, Math.min(newTotalDone, taskTotalGoal));

                    progressState[taskId] = newTotalDone;
                    saveState();
                    updateUI();
                }
            });
        }

        // --- Initialization ---
        loadState();
        render();
        updateUI();
        attachEventListeners();
    });
</script>
</body>
</html>
